---
import { Picture } from "@astrojs/image/components";
import { findImage } from '~/utils/images';
import { CollectionEntry } from 'astro:content';

export interface Props {
  post: CollectionEntry<"posts">;
  title: string;
  date: string;
  publication_url?: string;
  image: string;
}

const { post, href, title, date, publication_url, image } = Astro.props;
// const { Content } = Astro.props.post
const { Content } = await post.render();
// console.log(post);
// Default images
// var src = "";
// if (image != null) {
//   src = image;
// } else {
//   src = "/images/default.png";
// }
const featured_image = await findImage(image);

// Format date
var rawDate = new Date(date);
var formattedDate = rawDate.toLocaleString("en-GB", {
  dateStyle: "short",
  timeZone: "UTC",
});

// What sort of URL
var url = "";
if (publication_url != null) {
  url = publication_url;
} else {
  // TODO: Better way? Why is the slug wrong?
  url = `blog/${post.slug}`;
}

// Truncate text
// TODO: Better way?
// TODO: Make to helper or plugin
// var truncatedText = body.split("</p>");
---

<article class={`max-w-md mx-auto md:max-w-none grid gap-6 md:gap-8 ${image ? 'md:grid-cols-2' : ''}`}>
  <div class="relative h-0 pb-[56.25%] md:pb-[75%] lg:pb-[56.25%] overflow-hidden bg-gray-400 dark:bg-slate-700 rounded shadow-lg">

    <Picture
    src={featured_image ? featured_image: "~/assets/images/default.png"}
    class="absolute inset-0 object-cover w-full h-full mb-6 rounded shadow-lg bg-gray-400 dark:bg-slate-700"
    widths={[400, 900]}
    sizes="(max-width: 900px) 400px, 900px"
    alt={title}
    aspectRatio="16:9"
  />
</div>
  
    <div class="mt-2">
      <header>
      <h2 class="text-xl sm:text-2xl font-bold leading-tight mb-2 font-heading dark:text-slate-300">
        {
          url ? (
            <a class="hover:text-primary dark:hover:text-blue-700 transition ease-in duration-200" href={url}>
              {title}
            </a>
          ) : (
            title
          )
        }
      </h2>
      <i>{formattedDate}</i>
      </header>
      <Content />
    </div>

</article>